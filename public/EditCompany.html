<!DOCTYPE html>
<html>
<head>
	<title></title>
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

	<link type="text/css" rel="stylesheet" href="materialize/css/materialize.min.css"  media="screen,projection"/>


	<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
	<style type="text/css">
		header, main, footer {
			padding-left: 80px;
			margin-left: 12%;
		}

		main{
			padding-right: 50px;
		}

		@media only screen and (max-width : 992px) {
			header, main, footer {
				padding-left: 0;
			}
			@font-face{
				font-family: "Roboto";
				src: url(Roboto-Regular.woff) format('woff');
			}
			body{
				font-family:"Roboto",Verdana;
			}
		}

		.btn_small{
			height: 26px!important;
			line-height: 26px!important;
			font-size: 0.8rem!important;
		}

	</style>
</head>
<body>
	<script type="text/javascript" src="materialize/jquery-3.2.1.min.js"></script>
	<script type="text/javascript" src="materialize/js/materialize.min.js"></script>
	<script type="text/javascript">
		$(document).ready(function(){
			$(".button-collapse").sideNav({menuWidth: 220});

			$('select').material_select();
		});

		$(document).ready(function(){
			$("#filled-in-box").click(function(){
				$("#ilang").slideToggle();
			});
		});
	</script>

	<ul id="slide-out" class="side-nav fixed white-text" style="background-color:#cfcfcf; padding:8px;">
		<li>
			<h5>ActiveCollabV2<i class="material-icons right small">search</i></h5>
		</li>
		<li>
			<div class="divider accent-1"></div>
		</li>
		<li>
			<a href="#!">Projects<i class="material-icons left small">business_center</i></a>
		</li>
		<li>
			<a href="MyWork.html">My Work<i class="material-icons left small">computer</i></a>
		</li>
		<li>
			<a href="#!">Activity<i class="material-icons left small">hourglass_full</i></a>
		</li>
		<li>
			<a href="#!">Calendar<i class="material-icons left small">today</i></a>
		</li>
		<li>
			<a href="">People<i class="material-icons left small">group</i></a>
		</li>
		<li>
			<a href="#!">Invoices<i class="material-icons left small">local_atm</i></a>
		</li>
		<li>
			<a href="#!">Estimates<i class="material-icons left small">filter_tilt_shift</i></a>
		</li>
		<li><div class="divider accent-1"></div></li>
		<li>
			<a href="#!">Reports<i class="material-icons left small">report</i></a>
		</li>
		<li>
			<a href="#!">Trash<i class="material-icons left small">delete</i></a>
		</li>
		<li>
			<a href="#!">Add ons<i class="material-icons left small">settings_input_composite</i></a>
		</li>
		<li>
			<a href="#!">Settings<i class="material-icons left small">settings</i></a>
		</li>
		<li><div class="divider accent-1"></div></li>

		<li>
			<img src="" class="circle left"><a href="#!email"><span class="white-text email" id="iniUser"></span></a>
		</li>
	</ul>
	<a href="#" data-activates="slide-out" class="button-collapse"><i class="material-icons">menu</i></a>

	<header>

	</header>
	<main>
		<!--Isi Nya Disini!-->
			<div class ="row">
				<div class="col s9 push-s1">
					<button class="waves-effect waves-light btn white btn_small" style="color: black" id="backCompany" ><i class="material-icons left">settings_backup_restore</i> Company</button>
				</div>
			</div>
			<fieldset style="background-color: #ebf5ff">
					<br>
					<legend><b> Edit Company </b></legend>
					<br>
				</fieldset>
				<fieldset>
					<p style="color: #4caf50; padding: 10px;"><b> Name </b></p>	
					<div class="row">
						<div class="col s8 push-s2">
							<p> Company name * 
								<input type="text" class="validate" name="companyname" id="first_name2">
								<label class="active" for="first_name2">Name Company</label>
							</p>
						</div>
					</div>
					
				</fieldset>
				<fieldset>
					<p style="color: #4caf50; padding: 10px;"><b> Contact Detail </b></p>
					<div class="row">
						<div class="col s8 push-s2">
							<p> Address 
								<div class="input-field col s12">
									<textarea id="textarea1" class="materialize-textarea"></textarea>
									<label for="textarea1"> Write here </label>
								</div>
							</p>
							<p> Website
								<div class="input-field col s12" >
									<!--<select>
										<option value="" disabled selected> Choose here </option>
										<option value="2">http://</option>
										<option value="2">https://</option>
									</select>
									<label>Select here</label>-->
									<div class="input-field" >
										<input id="website" type="text" class="validate"></input>									
										<label for="website">Website name </label>
									</div>
								</div>
							</p>
							<p> Phone Number
								<div class="input-field col s6">
									<i class="material-icons prefix">phone</i>
									<input id="phone" type="number" class="validate">
									<label for="phone">Telephone</label>
								</div>						
							</p>
						</div>
					</div>	
					</fieldset>
					<fieldset>
					<p style="color: #4caf50; padding: 10px;"><b> Currency </b></p>
					<div class="row">
						<div class="col s8 push-s2">
							<p> Set Currency </p>
							<div class="input-field col s12">
								<select>
									<option value="1">Indonesia Rupiah</option>
								</select>
								<label> Select Currency</label>
							</div>
							<p style="font-size: 11px">The currency is applied to time records, tracked expenses, and invoices for this company.</p>
						</div>
					</div>
					</fieldset>
					<fieldset>
					<p style="color: #4caf50; padding: 10px;"><b> Custom Hourly Rates </b></p>
					<div class="row">
						<div class="col s8 push-s1">
							<p> Enable Custom Hourly Rates 
								<input type="checkbox" class="filled-in" id="filled-in-box" checked="checked" />
								<label for="filled-in-box"> .. </label>
							</p>
							<div id="ilang">
								<div class="col s8 push-s4">
									<p> Job Type <p> -- General </p></p>
									<p> IDR / HOUR <div class="input-field col s5">
										<input id="currency" type="number" class="validate">
										<label for="currency"> Set here </label>
									</div>		
								</p>
							</div>
						</div>
					</div>
				</div>
				</fieldset>
				<fieldset>
				<p style="color: #4caf50; padding: 10px;"><b> Note </b></p>
				<div class="row">
					<div class="col s8 push-s2">
						<p> Additional Information </p>
						<div class="input-field col s12">
							<textarea id="anyinfo" class="materialize-textarea"></textarea>
							<label for="anyinfo"> Note </label>
						</div>
					</div>
				</div>
				</fieldset>
				<fieldset>
				<br>
				<center><button class="waves-effect waves-light btn" id="editCompany" > Save Changes</button> <button class="waves-effect waves-light btn" id="btnCancel">Cancel</button></center>
				<br>
		</fieldset>
		<br>
		<br>
	</div>
</main>
<footer>

</footer>
<script>
	var companyList = $('#Listcompany');
    var baseUrl = (window.location).href; // You can also use document.URL
	var koopId = baseUrl.substring(baseUrl.lastIndexOf('=') + 1);
	//alert(koopId)
	$(document).ready(function(){

		var cookie = document.cookie;
		var splitCookie = cookie.split(",");

		$("#iniUser").append(splitCookie[1]);
		
		var baseUrl = (window.location).href; // You can also use document.URL
		var koopId2 = baseUrl.substring(baseUrl.lastIndexOf('=') + 1);
		//document.getElementById("destination").value = koopId2;
		
		$("#backCompany").click(function(){
			window.location = "http://localhost:3000/detailCompanyLink?id=" + koopId2;
		});
	});

	$(document).ready(function(){
		var baseUrl = (window.location).href; // You can also use document.URL
		var koopId3 = baseUrl.substring(baseUrl.lastIndexOf('=') + 1);
		//document.getElementById("destination").value = koopId2;

		$("#btnCancel").click(function(){
			window.location = "http://localhost:3000/detailCompanyLink?id=" + koopId3;
		})
	})

	$(document).ready(function(){

		var n = 0;
		var comprimer;

		$('#editCompany').click(function(){
			if(n == 1){
				//alert(comprimer);
				$.ajax({
					url:'http://localhost:3000/getCompanyOwner/' + koopId,
					type:'PUT',
					dataType:'JSON',
					data:{
						company_primer:comprimer,
						name:$('#first_name2').val(),
						address:$('#textarea1').val(),
						website:$('#website').val(),
						phone:$('#phone').val(),
						usd:$('#currency').val(),
						otherInfo:$('#anyinfo').val()
					},
					async: true,
					success:function(data) {
						//alert(JSON.stringify(data));
						//window.location.href = "detailCompanyLink?id=" + koopId;
						//alert(koopId);
						Materialize.toast('Editing Company Success', 2000);
							var delay = 2000;
							var timeoutID = setTimeout(function() {
								document.location = "Company.html?Id="+koopId;
							}, delay);
					},
					error:function(err)
					{
					alert(err);
					}          
				});
			}

			else{
				//alert("tidak");
				$.ajax({
					url:'http://localhost:3000/getCompany/' + koopId,
					type:'PUT',
					dataType:'JSON',
					data:{
						"name":$('#first_name2').val(),
						"address":$('#textarea1').val(),
						"website":$('#website').val(),
						"phone":$('#phone').val(),
						"usd":$('#currency').val(),
						"otherInfo":$('#anyinfo').val()
					},
					async: true,
					success:function(data) {
						//alert(JSON.stringify(data));
						//window.location.href = "detailCompanyLink?id=" + koopId;
						//alert(koopId);
						Materialize.toast('Editing Company Success', 2000);
							var delay = 2000;
							var timeoutID = setTimeout(function() {
								document.location = "Company.html?Id="+koopId;
							}, delay);
					},
					error:function(err)
					{
					alert(err);
					}          
				});
			}
		})

		$.ajax({
            url:'http://localhost:3000/getCompany/' + koopId,
            type:'GET',
            async: false,
            contentType : 'application/json',
            success:function(data) {
			  //alert(JSON.stringify(data));
			  var i = 0;
			  var idComp = data[i]._id;
			  comprimer = data[i].company_primer;
              $.each(data, function(key, val){
				//alert(data[i].name);
				$('#first_name2').val(data[i].name);
				$('#textarea1').val(data[i].address);
				$('#website').val(data[i].website);
				$('#phone').val(data[i].phone);
				$('#currency').val(data[i].usd);
				$('#anyinfo').val(data[i].otherInfo)
			  });
			  
			  $.ajax({
				  url:'http://localhost:3000/company_list/' + data[i].company_primer,
				  type:'GET',
				  async:false,
				  success:function(data){
					  //alert(JSON.stringify(data))
					  var a = 0;
					  //alert(data[a].company_sekunder[0]);
					  if(idComp == data[a].company_sekunder[0]){
						  n = n + 1;
					  }
				  },
				  error:function(err){
					  alert(err);
				  }
			  })

            },
            error:function(err)
            {
              alert(err);
            }          
        });
	})
</script>
</body>
</html>